name: Compilar APK Final
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Descargar Repositorio
        uses: actions/checkout@v4

      - name: 2. Descomprimir y Organizar
        run: |
          unzip CursorOverlay.zip
          PROYECTO_DIR=$(find . -name "build.gradle" -exec dirname {} + | head -n 1)
          echo "DIR_PATH=$PROYECTO_DIR" >> $GITHUB_ENV

      - name: 3. Configurar Java 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      - name: 4. Compilar APK (Modo Forzado)
        run: |
          cd ${{ env.DIR_PATH }}
          if [ ! -f gradlew ]; then gradle wrapper; fi
          chmod +x gradlew
          # Limpiamos todo antes de empezar y usamos opciones de compatibilidad
          ./gradlew clean assembleDebug --no-daemon --stacktrace

      - name: 5. Entregar APK
        uses: actions/upload-artifact@v4
        with:
          name: CursorOverlay-Instalable
          path: "**/*.apk"
