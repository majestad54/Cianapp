name: PMR AVANCS - Custom Elite Cursor
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Setup Build Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y apktool apksigner zipalign

      - name: Decompile HyperDroid
        # Usamos -r para evitar errores de recursos y trabajar solo en la estructura
        run: apktool d -r HyperDroid_1.1.apk -o decomp_app

      - name: Create Elegant Cursor Framework
        run: |
          # Creamos la carpeta donde vivirá tu flechita personalizada
          mkdir -p decomp_app/assets/img/
          # Instrucción para que el sistema use el cursor de hardware (más fluido)
          echo "hw_cursor=true" >> decomp_app/assets/config.ini
          echo "cursor_path=assets/img/cursor.png" >> decomp_app/assets/config.ini

      - name: Laptop View Configuration (1080p)
        run: |
          # Forzamos que todas las apps se abran en horizontal para visualización completa
          echo "orientation=landscape" >> decomp_app/assets/config.ini
          # Bajamos el DPI a 280 para que la interfaz se vea pequeña y profesional
          echo "preferred_dpi=280" >> decomp_app/assets/config.ini
          echo "screen_resolution=1920x1080" >> decomp_app/assets/config.ini

      - name: Build & Sign PMR AVANCS
        run: |
          # Reconstruimos el APK con los nuevos cambios
          apktool b decomp_app -o unsigned.apk
          # Alineamos el archivo para que Android lo acepte sin errores
          zipalign -v 4 unsigned.apk PMR_AVANCS_V4.apk
          # Creamos una firma digital para que no diga "paquete no válido"
          keytool -genkey -v -keystore debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000 -dname "C=US, O=Android, CN=PMR_AVANCS"
          apksigner sign --ks debug.keystore --ks-pass pass:android --out PMR_AVANCS_FINAL.apk PMR_AVANCS_V4.apk

      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: PMR-AVANCS-Package
          path: PMR_AVANCS_FINAL.apk
