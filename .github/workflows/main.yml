name: PMR AVANCS - Force Elite Transformation
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Tools
        run: sudo apt-get install -y apktool apksigner zipalign

      - name: Decompile
        run: apktool d HyperDroid_1.1.apk -o decomp_app

      - name: Force Custom Cursor (Surgery Mode)
        run: |
          # Buscamos todos los archivos de imagen que HyperDroid usa como puntero o icono y los reemplazamos
          # Tienes que tener un archivo llamado 'puntero.png' en tu repo
          find decomp_app/res -name "cursor.png" -exec cp puntero.png {} \;
          find decomp_app/res -name "puntero.png" -exec cp puntero.png {} \;
          # Si no existe, lo metemos en la ruta de assets crítica
          mkdir -p decomp_app/assets/img/
          cp puntero.png decomp_app/assets/img/cursor.png

      - name: Overwrite Manifest (Landscape & DPI)
        run: |
          # Forzamos horizontal en el corazón de la app
          sed -i 's/portrait/landscape/g' decomp_app/AndroidManifest.xml
          # Engañamos al sistema para que crea que es una tablet de 1080p
          sed -i '/<application/i <supports-screens android:smallScreens="false" android:normalScreens="true" android:largeScreens="true" android:xlargeScreens="true" android:anyDensity="true"/>' decomp_app/AndroidManifest.xml

      - name: Build & Sign
        run: |
          apktool b decomp_app -o unsigned.apk
          zipalign -v 4 unsigned.apk PMR_AVANCS_READY.apk
          keytool -genkey -v -keystore debug.keystore -storepass android -alias androiddebugkey -keypass android -keyalg RSA -keysize 2048 -validity 10000 -dname "C=US, O=Android, CN=PMR"
          apksigner sign --ks debug.keystore --ks-pass pass:android --out PMR_FINAL_AVANCS.apk PMR_AVANCS_READY.apk

      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: APK-MODIFICADO
          path: PMR_FINAL_AVANCS.apk
